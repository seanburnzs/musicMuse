2025-03-10 23:54:54,074 - db_optimization - INFO - Starting database optimization...
2025-03-10 23:54:54,074 - db_optimization - INFO - Connecting to database...
2025-03-10 23:54:54,119 - db_optimization - INFO - Creating index idx_listening_history_platform on listening_history(platform)...
2025-03-10 23:54:54,848 - db_optimization - INFO - Index idx_listening_history_platform created successfully in 0.72 seconds.
2025-03-10 23:54:54,848 - db_optimization - INFO - Creating index idx_listening_history_ms_played on listening_history(ms_played)...
2025-03-10 23:54:55,165 - db_optimization - INFO - Index idx_listening_history_ms_played created successfully in 0.32 seconds.
2025-03-10 23:54:55,165 - db_optimization - INFO - Creating index idx_listening_history_country on listening_history(country)...
2025-03-10 23:54:55,590 - db_optimization - INFO - Index idx_listening_history_country created successfully in 0.42 seconds.
2025-03-10 23:54:55,591 - db_optimization - INFO - Creating index idx_listening_history_user_platform on listening_history(user_id, platform)...
2025-03-10 23:54:56,296 - db_optimization - INFO - Index idx_listening_history_user_platform created successfully in 0.70 seconds.
2025-03-10 23:54:56,297 - db_optimization - INFO - Creating index idx_listening_history_timestamp_range on listening_history(timestamp DESC)...
2025-03-10 23:54:56,702 - db_optimization - INFO - Index idx_listening_history_timestamp_range created successfully in 0.40 seconds.
2025-03-10 23:54:56,702 - db_optimization - INFO - Creating index idx_tracks_name on tracks(track_name)...
2025-03-10 23:54:56,888 - db_optimization - INFO - Index idx_tracks_name created successfully in 0.18 seconds.
2025-03-10 23:54:56,889 - db_optimization - INFO - Creating index idx_albums_name on albums(album_name)...
2025-03-10 23:54:56,970 - db_optimization - INFO - Index idx_albums_name created successfully in 0.08 seconds.
2025-03-10 23:54:56,971 - db_optimization - INFO - Creating index idx_artists_name on artists(artist_name)...
2025-03-10 23:54:56,997 - db_optimization - INFO - Index idx_artists_name created successfully in 0.03 seconds.
2025-03-10 23:54:56,997 - db_optimization - INFO - Creating index idx_listening_history_skipped_true on listening_history(user_id, timestamp WHERE skipped = true)...
2025-03-10 23:54:57,006 - db_optimization - ERROR - Error creating index idx_listening_history_skipped_true: syntax error at or near "WHERE"
LINE 1: ...pped_true ON listening_history(user_id, timestamp WHERE skip...
                                                             ^

2025-03-10 23:54:57,007 - db_optimization - INFO - Creating index idx_listening_history_shuffle_true on listening_history(user_id, timestamp WHERE shuffle = true)...
2025-03-10 23:54:57,009 - db_optimization - ERROR - Error creating index idx_listening_history_shuffle_true: syntax error at or near "WHERE"
LINE 1: ...ffle_true ON listening_history(user_id, timestamp WHERE shuf...
                                                             ^

2025-03-10 23:54:57,009 - db_optimization - INFO - Creating index idx_user_events_category on user_events(category)...
2025-03-10 23:54:57,012 - db_optimization - INFO - Index idx_user_events_category created successfully in 0.00 seconds.
2025-03-10 23:54:57,012 - db_optimization - INFO - Creating index idx_user_hall_of_fame_composite on user_hall_of_fame(user_id, item_type, position)...
2025-03-10 23:54:57,014 - db_optimization - INFO - Index idx_user_hall_of_fame_composite created successfully in 0.00 seconds.
2025-03-10 23:54:57,016 - db_optimization - INFO - All additional indexes created successfully.
2025-03-10 23:54:57,017 - db_optimization - INFO - Database connection closed.
2025-03-10 23:54:57,017 - db_optimization - INFO - Connecting to database...
2025-03-10 23:54:57,078 - db_optimization - INFO - Adding duration_ms column to tracks table...
2025-03-10 23:54:57,079 - db_optimization - INFO - Column duration_ms added successfully.
2025-03-10 23:54:57,079 - db_optimization - INFO - Adding isrc column to tracks table...
2025-03-10 23:54:57,080 - db_optimization - INFO - Column isrc added successfully.
2025-03-10 23:54:57,080 - db_optimization - INFO - Adding release_date column to tracks table...
2025-03-10 23:54:57,080 - db_optimization - INFO - Column release_date added successfully.
2025-03-10 23:54:57,081 - db_optimization - INFO - Adding explicit column to tracks table...
2025-03-10 23:54:57,082 - db_optimization - INFO - Column explicit added successfully.
2025-03-10 23:54:57,082 - db_optimization - INFO - All track metadata columns added successfully.
2025-03-10 23:54:57,082 - db_optimization - INFO - Database connection closed.
2025-03-10 23:54:57,083 - db_optimization - INFO - Connecting to database...
2025-03-10 23:54:57,238 - db_optimization - INFO - Creating track_aliases table...
2025-03-10 23:54:57,254 - db_optimization - INFO - Track aliases table and indexes created successfully.
2025-03-10 23:54:57,257 - db_optimization - INFO - Creating potential_track_duplicates view...
2025-03-10 23:54:57,262 - db_optimization - INFO - Potential track duplicates view created successfully.
2025-03-10 23:54:57,262 - db_optimization - INFO - Creating function to merge duplicate tracks...
2025-03-10 23:54:57,273 - db_optimization - INFO - Track deduplication infrastructure created successfully.
2025-03-10 23:54:57,274 - db_optimization - INFO - Database connection closed.
2025-03-10 23:54:57,274 - db_optimization - INFO - Database optimization completed successfully.
2025-03-10 23:55:27,535 - db_optimization - INFO - Starting database optimization...
2025-03-10 23:55:27,535 - db_optimization - INFO - Connecting to database...
2025-03-10 23:55:27,584 - db_optimization - INFO - Creating index idx_listening_history_platform on listening_history(platform)...
2025-03-10 23:55:28,251 - db_optimization - INFO - Index idx_listening_history_platform created successfully in 0.66 seconds.
2025-03-10 23:55:28,252 - db_optimization - INFO - Creating index idx_listening_history_ms_played on listening_history(ms_played)...
2025-03-10 23:55:28,571 - db_optimization - INFO - Index idx_listening_history_ms_played created successfully in 0.32 seconds.
2025-03-10 23:55:28,571 - db_optimization - INFO - Creating index idx_listening_history_country on listening_history(country)...
2025-03-10 23:55:28,987 - db_optimization - INFO - Index idx_listening_history_country created successfully in 0.41 seconds.
2025-03-10 23:55:28,987 - db_optimization - INFO - Creating index idx_listening_history_user_platform on listening_history(user_id, platform)...
2025-03-10 23:55:29,634 - db_optimization - INFO - Index idx_listening_history_user_platform created successfully in 0.65 seconds.
2025-03-10 23:55:29,635 - db_optimization - INFO - Creating index idx_listening_history_timestamp_range on listening_history(timestamp DESC)...
2025-03-10 23:55:29,957 - db_optimization - INFO - Index idx_listening_history_timestamp_range created successfully in 0.32 seconds.
2025-03-10 23:55:29,957 - db_optimization - INFO - Creating index idx_tracks_name on tracks(track_name)...
2025-03-10 23:55:30,100 - db_optimization - INFO - Index idx_tracks_name created successfully in 0.14 seconds.
2025-03-10 23:55:30,100 - db_optimization - INFO - Creating index idx_albums_name on albums(album_name)...
2025-03-10 23:55:30,175 - db_optimization - INFO - Index idx_albums_name created successfully in 0.07 seconds.
2025-03-10 23:55:30,175 - db_optimization - INFO - Creating index idx_artists_name on artists(artist_name)...
2025-03-10 23:55:30,202 - db_optimization - INFO - Index idx_artists_name created successfully in 0.03 seconds.
2025-03-10 23:55:30,203 - db_optimization - INFO - Creating index idx_user_events_category on user_events(category)...
2025-03-10 23:55:30,204 - db_optimization - INFO - Index idx_user_events_category already exists. Skipping.
2025-03-10 23:55:30,204 - db_optimization - INFO - Creating index idx_user_hall_of_fame_composite on user_hall_of_fame(user_id, item_type, position)...
2025-03-10 23:55:30,204 - db_optimization - INFO - Index idx_user_hall_of_fame_composite already exists. Skipping.
2025-03-10 23:55:30,204 - db_optimization - INFO - Creating partial index idx_listening_history_skipped_true on listening_history(user_id, timestamp) WHERE skipped = true...
2025-03-10 23:55:30,360 - db_optimization - INFO - Partial index idx_listening_history_skipped_true created successfully in 0.15 seconds.
2025-03-10 23:55:30,360 - db_optimization - INFO - Creating partial index idx_listening_history_shuffle_true on listening_history(user_id, timestamp) WHERE shuffle = true...
2025-03-10 23:55:30,711 - db_optimization - INFO - Partial index idx_listening_history_shuffle_true created successfully in 0.35 seconds.
2025-03-10 23:55:30,715 - db_optimization - INFO - All additional indexes created successfully.
2025-03-10 23:55:30,715 - db_optimization - INFO - Database connection closed.
2025-03-10 23:55:30,715 - db_optimization - INFO - Connecting to database...
2025-03-10 23:55:30,766 - db_optimization - INFO - All track metadata columns added successfully.
2025-03-10 23:55:30,766 - db_optimization - INFO - Database connection closed.
2025-03-10 23:55:30,766 - db_optimization - INFO - Connecting to database...
2025-03-10 23:55:30,811 - db_optimization - INFO - Creating function to merge duplicate tracks...
2025-03-10 23:55:30,814 - db_optimization - INFO - Track deduplication infrastructure created successfully.
2025-03-10 23:55:30,814 - db_optimization - INFO - Database connection closed.
2025-03-10 23:55:30,814 - db_optimization - INFO - Database optimization completed successfully.
